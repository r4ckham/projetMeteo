<!DOCTYPE html>
<html lang="fr" dir="ltr">
  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Weather !</title>

    <!-- CSS -->

    <link rel="stylesheet" href="/projetMeteo/template/css/site.css">
    <link rel="stylesheet" href="/projetMeteo/template/library/weather-icons-master/css/weather-icons.css">
    <link rel="stylesheet" href="/projetMeteo/template/library/weather-icons-master/css/weather-icons-wind.css">
    <link rel="stylesheet" href="/projetMeteo/template/library/fontawesome-free-5.1.0-web/css/all.css">
    <link rel="stylesheet" href="/projetMeteo/template/library/bootstrap/css/bootstrap.min.css">

    <!-- JS  -->

    <script src="/projetMeteo/template/library/fontawesome-free-5.1.0-web/js/all.js" type="text/javascript"></script>
    <script src="/projetMeteo/template/js/JQuery.js" type="text/javascript"></script>
    <script src="/projetMeteo/template/library/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>

  </head>
  <body>

    <div class="container" style="margin-top:20px">

      <!-- Video de fond d'écran -->
      <video id="background-video" src="/projetMeteo/template/video/grosse-vague.mp4" playsinline autoplay muted loop> </video>

      <!-- Presentation top -->
      <div class="col-xs-12 text-center">
          <div class="jumbotron border-text">
            <h1 style="font-size:80px">Mété<i class="wi wi-day-sunny slow-spin sun" style="font-size:0.85em;"></i></h1>

            <h3>
              <table align="center">
                <tr>
                  <td style='width:30%'>
                  <hr/>
                </td>
                <td style='width:40%'> <span id="span-ville"> Montpellier </span> </td>
                <td style='width:30%'>
                  <hr/>
                </td>
              </tr>
            </table>
            </h3>



          </div>
      </div>

      <!-- row -->
        <div class="col-xs-6">
          <div class="panel panel-primary">
            <div class="panel-heading">
              <h3>Localisation automatique</h3>
            </div>
            <div class="panel-body">
              <!-- get automatic location  -->
              <button id="find_btn" class="btn">Trouvez moi !</button>
            </div>
            <div class="panel-footer">
              Merci d'accepter la fenêtre qui va s'ouvrir !
            </div>
          </div>
        </div>

        <div class="col-xs-6">
          <div class="panel panel-primary">
            <div class="panel-heading">
              <h3>Localisation manuelle</h3>
            </div>
            <div class="panel-body">
              <!-- manual location -->
              <div class="row">
                <div class="col-xs-8">
                  <div class="input-group">
                    <span class="input-group-addon"><i class="fas fa-location-arrow"></i></span>
                    <input id="manual-location" type="text" class="form-control" placeholder="Nom de votre ville">
                  </div>
                </div>
                <div class="col-xs-4">
                  <button id="btn-manual-location" class="btn"> Valider !</button>
                </div>
              </div>
            </div>
            <div class="panel-footer">
              Merci de valider après avoir saisi le nom de votre ville
            </div>
          </div>
        </div>
      <!-- end panel -->


      <div class="col-xs-12">
        <div class="panel">

          <div class="panel-heading">
            <h2>
              <span class="border-text"> Récapitulatif </span><i class="wi wi-day-sunny slow-spin sun"></i>
            </h2>
          </div>

          <div class="panel-body">

            <div class="col-md-4 col-xs-12 border-right">

              <div class="row">

                <div class="col-xs-6">

                  <h1 class="" style="padding:0;">
                    <i class="wi wi-thermometer border-sun" style="font-size: 52px;"> </i>
                    <span id="span-temperature" class="" style="font-size: 52px;">30</span>
                    <i class="wi wi-celsius"></i>
                  </h1>

                  <div class="row" style="margin-top:48px">
                    <div class="pull-left">
                      <h6 class="">
                        <i class="wi wi-sunset"> </i>
                        <span id="span-lever-soleil">34</span>
                      </h6>
                    </div>
                  </div>

                </div>

                <div class="col-xs-6" style="padding:0;">

                  <div class="col-xs-12">

                    <h2 class="">
                      <i class="wi wi-thermometer border-text-hot"> </i>
                      <span id="span-temperature-max" class="">MAXIMUM</span>
                      <i class="wi wi-celsius"></i>
                    </h2>

                  </div>

                  <div class="col-xs-12" >

                      <h2>
                        <i class="wi wi-thermometer border-text-cold"> </i>
                        <span id="span-temperature-min" class="">MINIMUM</span>
                        <i class="wi wi-celsius"></i>
                      </h2>
                  </div>

                  <div class="row">
                    <div class="pull-left">
                      <h6 class="">
                        <i class="wi wi-sunrise"> </i>
                        <span id="span-coucher-soleil">34</span>
                      </h6>
                    </div>
                  </div>

                </div>

              </div>

            </div>

            <div class="col-md-4 col-xs-12 border-right" style="height:159px">

              <div class="row text-center">
                <h1 class="">
                  <i id="icon-description" class="" style="font-size:80px"> </i>
                </h1>
                  <span id="span-description"> <small>Le temp est clair aujourd'hui !</small></span>
              </div>

            </div>

            <div class="col-md-4 col-xs-12" style="height:159px">

              <div class="row" style="margin-left:30%">
                <h3 class="">
                  <i id="icone-vent" class="wi wi-wind towards-0-deg"> </i>
                  <span id="span-vent">34</span> <small>km/h</small>
                </h3>
              </div>

              <div class="row" style="margin-left:30%">
                <h3 class="">
                  <i class="wi wi-humidity"> </i>
                  <span id="span-humidite">34</span> <small>%</small>
                </h3>
              </div>

              <div class="row" style="margin-left:30%">
                <h3 class="">
                  <i class="wi wi-barometer"> </i>
                  <span id="span-pression"></span> <small>hpa</small>
                </h3>
              </div>



            </div>

          </div>

      </div>

    </div>


  <!-- end container -->
    </div>
  <!-- end container -->
  </body>



  <script type="text/javascript">
    $("#find_btn").click(function () { //user clicks button
      if ("geolocation" in navigator){ //check geolocation available
          //try to get user current location using getCurrentPosition() method

          console.log(navigator)
          navigator.geolocation.getCurrentPosition(function(position){

            $("#result").html("Found your location <br />Lat : "+position.coords.latitude+" </br>Lang :"+ position.coords.longitude);
          });
      }else{
          console.log("Browser doesn't support geolocation!");
      }
    });
  </script>

  <script type="text/javascript">

  let ajaxUrl = "http://localhost:8080/ProjetJava/meteo/Montpellier";

  jQuery.fn.rotate = function(degrees) {
    $(this).css({'-webkit-transform' : 'rotate('+ degrees +'deg)',
                 '-moz-transform' : 'rotate('+ degrees +'deg)',
                 '-ms-transform' : 'rotate('+ degrees +'deg)',
                 'transform' : 'rotate('+ degrees +'deg)'});
    return $(this);
  };

  $("#btn-manual-location").click(function(){
    let inputManual = $("#manual-location").val();
    if(inputManual == ""){
      alert("champ vide !");
      return;
    }

    ajaxUrl = "http://localhost:8080/ProjetJava/meteo/" + inputManual;
    $("#span-ville").html(capitalizeFirstLetter(inputManual));
    init();
  });

  function capitalizeFirstLetter(string) {
      return string.charAt(0).toUpperCase() + string.slice(1);
  }

  $(document).ready(function(){

    init();

  });

  function init(){
    $.get(ajaxUrl  , function(data){

      console.log(data);

      $("#span-temperature").html(data.main.temp);
      $("#span-temperature-min").html(data.main.temp_min);
      $("#span-temperature-max").html(data.main.temp_max);

      let dateCoucherSoleil = data.sys.sunrise;
      let dateLeverSoleil = data.sys.sunset;

      dateCoucherSoleilConverted  = convert(dateCoucherSoleil)
      dateLeverSoleilConverted = convert(dateLeverSoleil)

      $("#span-coucher-soleil").html(dateCoucherSoleilConverted);
      $("#span-lever-soleil").html(dateLeverSoleilConverted);

      $("#span-pression").html(data.main.pressure);
      $("#span-humidite").html(data.main.humidity);
      $("#span-visibilite").html(data.visibility);

      let description = data.weather[0].main ;
      let idWeather = data.weather[0].id;

      let span = $("#span-description");
      let icon = chooseIconDescription(description , dateCoucherSoleil , dateLeverSoleil , idWeather , span);

      $("#icon-description").removeClass();
      $("#icon-description").addClass("wi " + icon);

      $("#span-vent").html(Math.round(data.wind.speed * 3.6));
      $("#icone-vent").rotate(data.wind.deg);

    } , "Json");
  }

  function convert (time)
  {
    let $1970 = 1970*31536000;

    var a = new Date(time * 1000);
    var months = ['Janvier','Fevrier','Mars','Avril','Mai','Juin','Juillet','Aout','Septembre','Octobre','Novembre','Decembre'];
    var year = a.getFullYear();
    var month = months[a.getMonth()];
    var date = a.getDate();
    var hour = a.getHours();
    var min = a.getMinutes();
    var sec = a.getSeconds();
    if(hour < 10)
    {
      hour = "0" + hour;
    }

    if(min < 10)
    {
      min = "0" + min;
    }
    //var time = date + ' ' + month + ' ' + year + ' ' + hour + ':' + min + ':' + sec ;
    var time = date + ' ' + month + ' ' + year + '<b> ' + hour + ': ' + min + '</b>' ;

    console.log(time);

    return time;
  }

  function changeVideoBackground(videoFile){
    let video = $("#background-video");
    let baseSrc="/projetMeteo/template/video/";

    console.log(video);

    video.attr('src', baseSrc + videoFile + ".mp4");
    video[0].load();
  }

  function chooseIconDescription(description , dateCoucherSoleil , dateLeverSoleil , idWeather , span ){

    let currentTime = Math.round((new Date()).getTime() / 1000);

    let isDay;
    let iconIsDay;

    let IconCondition;
    let descriptionDebut = "Le temps est "
    let descrCondition = "";
    let descrDay = "";

    let descriptionTotale = descriptionDebut + descrCondition + descrDay;

    let firstIdWeather = idWeather.charAt(0);
    //firstIdWeather = 7;
    console.log(firstIdWeather , 'idWeather => ', idWeather , currentTime , dateCoucherSoleil , dateLeverSoleil);

    if(currentTime < dateCoucherSoleil)
    {
      isDay = false;
    }else{
      isDay = true;
    }

    console.log(isDay)

    if(idWeather == "800"){

      if(isDay){
        iconIsDay = "wi-day";
        iconCondition = "sunny sun border-text";
        descrDay = " aujourd'hui !";
        changeVideoBackground("grosse-vague");
      }else{
        iconIsDay = "wi-stars";
        //iconCondition = "clear";
        descrDay = " ce soir !";
        changeVideoBackground("clearNight");
      }

      descrCondition = "clair";
      descriptionTotale = descriptionDebut + descrCondition + descrDay;

      span.html(descriptionTotale);
      console.log(iconIsDay + "-" + iconCondition)
      return iconIsDay + "-" + iconCondition;
    }

    if(isDay){
      iconIsDay = "wi-day";
      descrDay = " aujourd'hui !";
    }else{
      iconIsDay = "wi-night"
      descrDay = " ce soir !";
    }

    if(firstIdWeather == "2"){
      inconCondition = "lightning";
      descrCondition = "nuageux";

      changeVideoBackground("orage");
    }

    if(firstIdWeather == "3"){
      inconCondition = "haze";
      descrCondition = "bruineux";

    }

    if(firstIdWeather == "5"){
      inconCondition = "rain";
      descrCondition = "pluvieux";
    }

    if(firstIdWeather == "6"){
      inconCondition = "snow";
      descrCondition = "neigeux";

      changeVideoBackground("neigeJour");
    }

    if(firstIdWeather == "7"){

      changeVideoBackground("pompiers");

      iconIsDay = "wi";

      if(idWeather == "701"){
        iconCondition ="smog";
        descrCondition = "légérement brumeux";
      }
      if(idWeather == "711"){
        iconCondition ="smoke";
        descrCondition = "lourdement brumeux";
      }
      if(idWeather == "721"){
        iconCondition ="windy";
        descrCondition = "venteux";
      }
      if(idWeather == "731"){
        iconCondition ="dust";
        descrCondition = "est rempli de poussière";
      }
      if(idWeather == "741"){
        iconCondition ="smog";
        descrCondition = "brumeux";
      }
      if(idWeather == "751"){
        iconCondition ="alien";
        descrCondition = "polluer";
      }
      if(idWeather == "761"){
        iconCondition ="dust";
        descrCondition = "poussiéreux";
      }
      if(idWeather == "762"){
        iconCondition ="volcano";
        descrCondition = "dangeureux (volcan)";
      }
      if(idWeather == "771"){
        iconCondition ="gale-warning";
        descrCondition = "dangeureux (vents forts)";
      }
      if(idWeather == "781"){
        iconCondition ="tornado";
        descrCondition = "dangeureux (torande)";
      }

      descriptionTotale = descriptionDebut + descrCondition + descrDay;
      span.html(descriptionTotale);

      console.log(isDay , iconIsDay + "-" + iconCondition);
      return iconIsDay + "-" + iconCondition;
    }

    if(firstIdWeather == "8"){
      iconCondition = "cloudy-gusts";
      descrCondition = "nuagueux";

      if(isDay){
        changeVideoBackground("jourNuage");
      }else{
        changeVideoBackground("nuitNuage");
      }

    }

    descriptionTotale = descriptionDebut + descrCondition + descrDay;
    span.html(descriptionTotale);
    console.log(isDay , iconIsDay + "-" + iconCondition);
    return iconIsDay + "-" + iconCondition;

  }

  </script>


</html>
